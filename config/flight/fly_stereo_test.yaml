fly_stereo:
  wait_for_start_command: false
  record_mode: false
  log_dir: /home/msardonini/log
  vio:
    vio_calibration: [-0.0021, 0.0004, -0.0012]
    kalman_filter:
        dt: 0.2
        sigma_a: 0.1
        f: [0.0, 1.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
        h:  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 1.0, 0.0]
        r:  [0.001, 0.0, 0.0, 
            0.0, 0.001, 0.0, 
            0.0, 0.0, 0.001]

  mavlink_reader:
    device: /dev/ttyTHS1
    replay_mode: false
    # device: /tmp/imu.dat
    # replay_mode: true
    replay_imu_data_file: <log_dir>/imu.dat

  # All params for the image processing process
  image_processor:
    draw_points_to_frame: true
    max_error_counter: 10

    thresholds:
      stereo_threshold: 35
      ransac_threshold: 5

    goodFeaturesToTrack:
      max_corners: 100
      quality_level: 0.3
      min_dist: 10.0

    calcOpticalFlowPyrLK:
      window_size: 21
      max_pyramid_level: 3
      max_iters: 30

    binning:
      bins_width: 20
      bins_height: 15
      max_pts_in_bin: 2

    # Minumum time before two triggers are allowed
    min_camera_dt_ms: 40

    CameraTrigger:
      chip_num: 0
      pin_num: 79
      auto_trigger_async: false
      auto_trigger_async_rate_hz: 20
      replay_mode: false
    Camera0:
      gstreamer_pipeline:
        enable: true

      auto_exposure:
        enable: true
        pixel_range_limits: [95, 168]
        exposure_limits: [51, 2000]
        num_frames_to_calc: 3

      src_pipeline: "v4l2src device=/dev/video0 ! video/x-raw,width=1280,height=720 ! nvvidconv ! video/x-raw, format=(string)GRAY8 ! appsink max-buffers=10 drop=false"
      sink_pipeline: "appsrc ! videoconvert ! nvvidconv ! nvv4l2h264enc insert-sps-pps=true ! h264parse ! rtph264pay pt=96 ! udpsink host=192.168.104.2 port=8000 sync=false "

      device_num: 0
      enable_videoflip: false
      flip_method: 0
      framerate: 20
      width: 1280
      height: 720
      hardware_trigger_mode: true
      gain: 1
      exposure_time: 500
    Camera1:
      gstreamer_pipeline:
        enable: true

      enable_videoflip: true
      flip_method: -1
      auto_exposure:
        enable: true
        pixel_range_limits: [95, 168]
        exposure_limits: [51, 2000]
        num_frames_to_calc: 3

      device_num: 1
      src_pipeline: "v4l2src device=/dev/video1 ! video/x-raw,width=1280,height=720 ! nvvidconv ! video/x-raw, format=(string)GRAY8 ! appsink max-buffers=10 drop=false"
      sink_pipeline: "appsrc ! videoconvert ! nvvidconv ! nvv4l2h264enc insert-sps-pps=true ! h264parse ! rtph264pay pt=96 ! udpsink host=192.168.104.2 port=8001 sync=false "
      framerate: 20
      width: 1280
      height: 720
      hardware_trigger_mode: true
      gain: 1
      exposure_time: 500

  stereo_calibration:
    R_imu_cam0: [3.14, 0.0, 0.0]
    K0: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 6.9266160620735968e+02, 0., 6.4340546649960936e+02, 0.,
           6.9303606599750344e+02, 3.8993528220422058e+02, 0., 0., 1. ]
    D0: !!opencv-matrix
       rows: 8
       cols: 1
       dt: d
       data: [ 7.5814587445191151e-01, -2.2071979921706167e-01,
           -9.6014344059653847e-05, -1.0410690956962723e-04,
           -3.2333864166542374e-02, 1.1401965989004299e+00,
           -4.0826540278268028e-02, -1.2241246743581756e-01 ]
    K1: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 6.9443844806646018e+02, 0., 6.5366979636925976e+02, 0.,
           6.9513978994046602e+02, 3.3415174032837172e+02, 0., 0., 1. ]
    D1: !!opencv-matrix
       rows: 8
       cols: 1
       dt: d
       data: [ 9.8997214959274549e-01, -1.3443248367442798e-01,
           -3.3157288248950333e-06, 7.8150614845257676e-05,
           -3.5381989504229078e-02, 1.3681155537454635e+00,
           1.3766990943721819e-01, -1.1661833720179574e-01 ]
    R: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 9.9981398327686666e-01, -1.9231562311064525e-02,
           1.4648737560277972e-03, 1.9179366673017593e-02,
           9.9937142054086314e-01, 2.9814689335279372e-02,
           -2.0373360222109955e-03, -2.9781047953571449e-02,
           9.9955436992927982e-01 ]
    T: !!opencv-matrix
       rows: 3
       cols: 1
       dt: d
       data: [ -1.1861305608535490e-04, 1.3433474420376143e-01,
           2.1537018220222054e-05 ]
    E: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ -2.7409807977031201e-04, -4.0221529394559308e-03,
           1.3427423848269429e-01, 2.1291357322799438e-05,
           -3.9466116190943463e-06, 1.1859174755355715e-04,
           -1.3431203061813657e-01, 2.4649285053408377e-03,
           -2.0031985272509029e-04 ]
    F: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 1.0110550351386194e-07, 1.4828344359297469e-06,
           -3.4950251378538223e-02, -7.8457372803101519e-09,
           1.4535168893256193e-09, -2.5788339541978356e-05,
           3.4341208365728369e-02, -1.6008319799982148e-03, 1. ]
