fly_stereo:
  wait_for_start_command: false
  record_mode: false
  log_dir: /home/msardonini/log
  mavlink_reader:
    # device: /dev/ttyTHS1
    # replay_mode: false
    device: /root/fly_stereo/replay_data/flight/run013/imu.dat
    replay_mode: true
    # replay_imu_data_file: /home/msardonini/git/fly_stereo/replay_data/test_replay/imu.dat

  vio:
    vio_calibration: [-0.0018, 0.0001, -0.0019]
    image_width: 1280
    image_height: 720
    # bins_width: 40
    # bins_height: 30
    bins_width: 20
    bins_height: 15
    max_pts_in_bin: 2
    kalman_filter:
        dt: 0.2
        sigma_a: 0.1
        f: [0.0, 1.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 1.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
        h:  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 1.0, 0.0]
        r:  [0.001, 0.0, 0.0, 
            0.0, 0.001, 0.0, 
            0.0, 0.0, 0.001]

  image_processor:
    CameraTrigger:
      replay_mode: true
      chip_num: 0
      pin_num: 79
      auto_trigger_async: false
      auto_trigger_async_rate_hz: 20
    Camera0:
      auto_exposure:
        enable: false
        pixel_range_limits: [108, 148]
        exposure_limits: [51, 2500]
        num_frames_to_calc: 3

      gstreamer_pipeline:
        enable: false

      src_pipeline: "filesrc location=/root/fly_stereo/replay_data/flight/run013/cam0.mp4 ! decodebin ! videoconvert ! video/x-raw, format=(string)GRAY8 ! appsink sync=true "
      # src_pipeline: "filesrc location=/root/fly_stereo/replay_data/test_replay/cam0.mp4 ! decodebin ! videoconvert ! appsink "
      sink_pipeline: "appsrc ! videoconvert ! tee name=t ! queue ! autovideosink t. ! queue ! jpegenc ! avimux ! filesink location=/root/fly_stereo/replay_data/flight/run013/cam0_annotated.avi"

      enable_videoflip: false
      flip_method: -1
      device_num: 0
      framerate: 20
      width: 1280
      height: 720
      hardware_trigger_mode: true
      gain: 3
      exposure_time: 1500
    Camera1:
      auto_exposure:
        enable: false
        pixel_range_limits: [108, 148]
        exposure_limits: [51, 2500]
        num_frames_to_calc: 3

      gstreamer_pipeline:
        enable: false

      src_pipeline: "filesrc location=/root/fly_stereo/replay_data/flight/run013/cam1.mp4 ! decodebin ! videoconvert ! video/x-raw, format=(string)GRAY8 ! appsink sync=true "
      # src_pipeline: "filesrc location=/root/fly_stereo/replay_data/test_replay/cam1.mp4 ! decodebin ! videoconvert ! appsink max-buffers=1"
      sink_pipeline: "appsrc ! videoconvert ! tee name=t ! queue ! autovideosink t. ! queue ! jpegenc ! avimux ! filesink location=/root/fly_stereo/replay_data/flight/run013/cam1_annotated.avi"

      device_num: 1
      enable_videoflip: false
      flip_method: -1
      framerate: 20
      width: 1280
      height: 720
      hardware_trigger_mode: true
      gain: 3
      exposure_time: 1500
    draw_points_to_frame: true
    max_error_counter: 10
    stereo_threshold: 25
    ransac_threshold: 10

    goodFeaturesToTrack:
      max_corners: 300
      quality_level: 0.15
      min_dist: 15.0

    calcOpticalFlowPyrLK:
      window_size: 21
      max_pyramid_level: 5

    # Minumum time before two triggers are allowed
    min_camera_dt_ms: 40

  stereo_calibration:
    R_imu_cam0: [3.14, 0.0, 0.0]
    K0: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 6.9266160620735968e+02, 0., 6.4340546649960936e+02, 0.,
           6.9303606599750344e+02, 3.8993528220422058e+02, 0., 0., 1. ]
    D0: !!opencv-matrix
       rows: 8
       cols: 1
       dt: d
       data: [ 7.5814587445191151e-01, -2.2071979921706167e-01,
           -9.6014344059653847e-05, -1.0410690956962723e-04,
           -3.2333864166542374e-02, 1.1401965989004299e+00,
           -4.0826540278268028e-02, -1.2241246743581756e-01 ]
    K1: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 6.9443844806646018e+02, 0., 6.5366979636925976e+02, 0.,
           6.9513978994046602e+02, 3.3415174032837172e+02, 0., 0., 1. ]
    D1: !!opencv-matrix
       rows: 8
       cols: 1
       dt: d
       data: [ 9.8997214959274549e-01, -1.3443248367442798e-01,
           -3.3157288248950333e-06, 7.8150614845257676e-05,
           -3.5381989504229078e-02, 1.3681155537454635e+00,
           1.3766990943721819e-01, -1.1661833720179574e-01 ]
    R: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 9.9981398327686666e-01, -1.9231562311064525e-02,
           1.4648737560277972e-03, 1.9179366673017593e-02,
           9.9937142054086314e-01, 2.9814689335279372e-02,
           -2.0373360222109955e-03, -2.9781047953571449e-02,
           9.9955436992927982e-01 ]
    T: !!opencv-matrix
       rows: 3
       cols: 1
       dt: d
       data: [ -1.1861305608535490e-04, 1.3433474420376143e-01,
           2.1537018220222054e-05 ]
    E: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ -2.7409807977031201e-04, -4.0221529394559308e-03,
           1.3427423848269429e-01, 2.1291357322799438e-05,
           -3.9466116190943463e-06, 1.1859174755355715e-04,
           -1.3431203061813657e-01, 2.4649285053408377e-03,
           -2.0031985272509029e-04 ]
    F: !!opencv-matrix
       rows: 3
       cols: 3
       dt: d
       data: [ 1.0110550351386194e-07, 1.4828344359297469e-06,
           -3.4950251378538223e-02, -7.8457372803101519e-09,
           1.4535168893256193e-09, -2.5788339541978356e-05,
           3.4341208365728369e-02, -1.6008319799982148e-03, 1. ]



    # K0: !!opencv-matrix
    #    rows: 3
    #    cols: 3
    #    dt: d
    #    data: [ 6.9314248828849281e+02, 0., 6.4308898467735969e+02, 0.,
    #        6.9323599574389686e+02, 3.9046468435606590e+02, 0., 0., 1. ]
    # D0: !!opencv-matrix
    #    rows: 8
    #    cols: 1
    #    dt: d
    #    data: [ 3.0006434241674342e+00, -1.9447106115837715e-01,
    #        -1.4805222365979966e-04, -8.2460156653682871e-05,
    #        -1.2754900109344144e-01, 3.3859743814035368e+00,
    #        8.1176666398200670e-01, -3.6589221344530154e-01 ]
    # K1: !!opencv-matrix
    #    rows: 3
    #    cols: 3
    #    dt: d
    #    data: [ 6.9902495137468748e+02, 0., 6.5356203542001072e+02, 0.,
    #        6.9947795736546811e+02, 3.3588044741482810e+02, 0., 0., 1. ]
    # D1: !!opencv-matrix
    #    rows: 8
    #    cols: 1
    #    dt: d
    #    data: [ 4.8405953099901744e+00, -4.0881138806539397e-01,
    #        -2.4695340246757127e-04, -9.3988224902087112e-06,
    #        -2.1997626024937039e-01, 5.2335749615623905e+00,
    #        1.2626565521859110e+00, -6.4775473166467967e-01 ]
    # R: !!opencv-matrix
    #    rows: 3
    #    cols: 3
    #    dt: d
    #    data: [ 9.9981861095067737e-01, -1.9044586845051965e-02,
    #        2.2115279608806370e-04, 1.9030391030368268e-02,
    #        9.9940670257521513e-01, 2.8706916674673257e-02,
    #        -7.6773295436816612e-04, -2.8697500930161639e-02,
    #        9.9958784707822157e-01 ]
    # T: !!opencv-matrix
    #    rows: 3
    #    cols: 1
    #    dt: d
    #    data: [ 1.3349584465017770e-03, 1.3364204509281125e-01,
    #        7.7758831569257700e-03 ]
    # E: !!opencv-matrix
    #    rows: 3
    #    cols: 3
    #    dt: d
    #    data: [ -2.5057949918965951e-04, -1.1606462458832992e-02,
    #        1.3336374250359592e-01, 7.7754975884643833e-03,
    #        -1.0977851081883778e-04, -1.3326885811753902e-03,
    #        -1.3359239910805612e-01, 3.8793239530136672e-03,
    #        8.7672289406754716e-06 ]
    # F: !!opencv-matrix
    #    rows: 3
    #    cols: 3
    #    dt: d
    #    data: [ 9.9912893702063363e-08, 4.6271895175907923e-06,
    #        -3.8729391439337964e-02, -3.0982954998772906e-06,
    #        4.3737443693673988e-08, 2.3434848504093218e-03,
    #        3.8210277811869628e-02, -4.1199466362062658e-03, 1. ]